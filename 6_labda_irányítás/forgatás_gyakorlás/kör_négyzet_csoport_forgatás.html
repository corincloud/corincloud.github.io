<html>

<head>
    <title>kacsacsőr</title>
    <style>
        #rajzlap {
            display: block;
            border: 1px solid rgb(96, 212, 247);
            width: 300px;
            height: 300px;
            position: relative;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        body {
            margin-top: 0%;
        }
    </style>

</head>

<body>
    <svg id="rajzlap" viewBox="0 0 300 300">
    </svg>
    <script> 
        var x_pozicio = 0;
        var y_pozicio = 0;
        var alaphelyzet_x;
        var alaphelyzet_y;
        var körök_száma = 0;
        var szélesség = window.innerWidth;
        var rajzlap_balszél = szélesség / 2 - 150;
        var hosszúság = window.innerHeight;
        var rajzlap_teteje = hosszúság / 2 - 150;
        var rajzlap = document.getElementById("rajzlap");
        rajzlap.onmousedown = kör_létrehozás;
        window.addEventListener("keydown", billentyű_lenyomás);
        window.addEventListener("keyup", billentyű_felengedés);

        function kör_létrehozás(e) {
            if (körök_száma < 1) {
                var x_koordináta = e.pageX - rajzlap_balszél;
                var y_koordináta = e.pageY - rajzlap_teteje;
                x_pozicio = x_koordináta;
                y_pozicio = y_koordináta;
                alaphelyzet_x = x_koordináta;
                alaphelyzet_y = y_koordináta;

                var kör = document.createElementNS("http://www.w3.org/2000/svg", 'circle');
                kör.setAttribute("r", 6);
                kör.setAttribute("cx", x_pozicio.toString());
                kör.setAttribute("cy", y_pozicio.toString());
                kör.setAttribute('id', "kor");
                //rajzlap.appendChild(kör);
                var négyzet = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
                négyzet.setAttribute('width', '6');
                négyzet.setAttribute('height', '6');
                négyzet.setAttribute('x', (x_pozicio + 3));
                négyzet.setAttribute('y', y_pozicio - 3);
                négyzet.setAttribute('transform', 'rotate(45, ' + (x_pozicio + 6) + ',' + y_pozicio + ')');
                négyzet.setAttribute('id', 'n');

                //rajzlap.appendChild(négyzet);

                var csoport = document.createElementNS("http://www.w3.org/2000/svg", 'g');
                csoport.appendChild(kör);
                csoport.appendChild(négyzet);
                csoport.setAttribute('id', 'csoport');
                rajzlap.appendChild(csoport);
                csoport.setAttribute('fill', 'blue');

                //csoport.setAttribute('transform', ' rotate(30, ' + x_pozicio + ', ' + y_pozicio + ') translate(50 20)');
                //x_pozicio = x_pozicio + 50;
                //y_pozicio = y_pozicio + 20;
                //csoport.setAttribute('transform', 'rotate(30, ' + x_pozicio + ', ' + y_pozicio + ')');

                körök_száma++;
            }
        }



        var kapcsoló = 0;
        var irány_kapcsoló = 0;
        var szög = 0;
        var eltolás_x = 0;
        var eltolás_y = 0;
        function billentyű_lenyomás(e) {
            switch (e.key) {
                case 'ArrowUp':
                    kapcsoló = 1;
                    break;
                case 'ArrowRight':
                    irány_kapcsoló = 1;
                    break;
                case 'ArrowLeft':
                    irány_kapcsoló = -1;
                    break;
            }
        }

        function billentyű_felengedés(e) {
            if (e.key == "ArrowUp") {
                kapcsoló = 0;
            }
            if ((e.key == 'ArrowRight') || (e.key == 'ArrowLeft')) {
                irány_kapcsoló = 0;
            }
        }

        function szimulacio_indito() {
            var aktualis_ido = Date.now() / 1000;
            var szimulacio_differencia = (aktualis_ido - legutobbi_szimulacio);
            szimulacio(szimulacio_differencia);
            legutobbi_szimulacio = aktualis_ido;
        }

        function szimulacio(ido_kulonbseg) {

            if ((körök_száma == 1) && (kapcsoló == 1)) {
                // if (körök_száma == 1) {
                var v0 = 80; //pixel/sec
                var w = 180; //szögsebesség: fok/sec
                w = w * irány_kapcsoló; //a forgatás irányát határozza meg
                var s0_x = x_pozicio;
                var s0_y = y_pozicio;
                var t = ido_kulonbseg;
                szög = szög + w * t;

                szög_radián = (szög * Math.PI) / 180;

                var v0_x = v0 * Math.cos(szög_radián);
                var v0_y = v0 * Math.sin(szög_radián);

                if ((s0_x + v0_x * t < 5) || (s0_x + v0_x * t > 295)) {
                    v0_x = 0;
                }
                if ((s0_y + v0_y * t < 5) || (s0_y + v0_y * t > 295)) {
                    v0_y = 0;
                }

                var s_x = s0_x + v0_x * t;
                var s_y = s0_y + v0_y * t;

                x_pozicio = s_x;
                y_pozicio = s_y;

                eltolás_x = x_pozicio - alaphelyzet_x;
                eltolás_y = y_pozicio - alaphelyzet_y;

                kacsacsor_pozicio_frissites();

            }
        }



        function kacsacsor_pozicio_frissites() {
            var csoport = document.getElementById("csoport");
            csoport.setAttribute('transform',
                ' translate(' + eltolás_x + ', ' + eltolás_y + ') rotate(' + szög + ', ' + alaphelyzet_x + ', ' + alaphelyzet_y + ')');
        }
        var legutobbi_szimulacio = Date.now() / 1000;
        setInterval(szimulacio_indito, 10);


    </script>
</body>

</html>